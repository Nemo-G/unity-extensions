---
name: csharp-code-writer
description: Unity C# 代码编写技能 - 根据调用方提供的编码需求实现脚本逻辑，并保证编译无错误（必要时修复编译错误）。
---

# C# Code Writer

## Overview

此技能提供 Unity C# 游戏脚本的编写、编译与编译错误修复工作流程。目标是把代码**写对**：实现完整逻辑，并确保 Unity 编译无错误。

本技能聚焦“编码正确性与可编译性”，不承担业务验收/功能验收职责（验收要求由调用方定义）。

## When to Use This Skill

使用此技能当：
- 需要实现多个相关的游戏脚本（例如玩家控制、游戏管理、AI、工具类等）
- 需要确保所有编写的代码能够通过 Unity 编译且无错误（并在出现编译错误时自动修复）
- 需要自动诊断并修复 C# 编译错误
- 需要验证代码的完整性和实现质量（不只是空框架）

## Core Workflow

### 步骤1：理解调用方下发的编码需求

1. 从调用方提供的 `task`/上下文中提取：目标脚本清单、路径规范、关键接口/方法要求、行为约束与边界条件
2. 如需补充背景，只读取调用方明确指定的文档/文件路径（避免自行扩展范围导致偏离需求）
3. **代码行数限制**：本次任务新增/修改的总代码行数不超过 3000 行；若接近上限，必须停止并把剩余项留给后续开发者（已开始修改的脚本不得留下半成品）

### 步骤2：创建任务清单

使用 `todo_write` 创建 C# 脚本编写任务列表：
- 每个脚本作为一个独立任务
- 推荐顺序：核心管理类 → 实体控制类 → 工具类
- 确保所有脚本都在任务列表中

### 步骤3：编写C#代码

使用 `unity_script` 创建每个脚本文件：

**文件路径规范**：
- 路径：优先遵循调用方给出的路径约定；若未给出，默认：`Assets/Games/{GameName}/Scripts/{ScriptName}.cs`
- 文件名必须与调用方要求一致
- 使用 PascalCase 命名规范

**代码完整性要求**：
- ✅ 所有方法必须完全实现，不能只有空框架 `{}`
- ✅ 必须包含具体的功能实现代码
- ✅ 必须处理边界情况和错误情况
- ❌ 不能包含 `NotImplementedException`
- ❌ 不能包含 `throw new System.NotImplementedException()`
- ❌ 方法体内不能只有注释而没有可执行代码

**代码质量标准**：
- 方法体必须有实际的代码逻辑
- 返回值必须是合理的实现结果
- 必须实现架构文档中描述的所有功能
- 添加适当的注释说明复杂逻辑
- 符合 Unity 和 C# 最佳实践

### 步骤4：代码完整性检查

在触发编译前，必须验证代码完整性：

1. 读取所有已创建的 C# 脚本
2. 逐行检查代码内容，验证：
   - 所有方法都有实际的功能代码
   - 方法体内不能只有空括号 `{}`
   - 不能包含未实现的异常抛出
   - 返回值是合理的实现，不是占位符
3. 如果发现未完全实现的代码：
   - 分析架构文档中的对应功能需求
   - 补全缺失的实现
   - 返回 Step 3 重新编写
4. 确认所有代码完全实现后，进入下一步

### 步骤5：触发代码编译

每次编写或修改脚本后，必须触发 Unity 编译

### 步骤6：检查编译报错

编译完成后必须检查 Unity Console，并对**编译错误**进行修复，直到编译无错误为止。

推荐优先使用：`unity_workflow { "action": "compile_and_validate" }`（会返回 `hasErrors/hasWarnings` 并包含对应 console entries）。

**当日志过多时可以选择精简日志模式或减少获取日志数量**：
```json
{
  "action": "get",
  "format": "plain",
  "since_token": "your_token_here",
  "includeStacktrace": false
}
```

### 步骤7：向调用方回传结果

向调用方输出清晰的实现回传信息，至少包含：
- 本次创建/修改的脚本清单与路径
- 编译结果（无错误；若仍有 warning 需说明）
- 任何需要调用方在“验收/验证阶段”处理的注意事项（若调用方提供了对应约束/标准）

## Code Quality Standards

### Implementation Requirements

- **Complete Implementation**: 所有方法必须完全实现，不能只有空框架
- **Error Handling**: 必须处理边界情况和错误情况
- **Return Values**: 返回值必须是合理的实现结果，不是简单占位符
- **No Placeholders**: 不能包含 `NotImplementedException` 或类似占位符

## Success Criteria

- ✅ 所有 C# 脚本文件已创建
- ✅ 所有脚本成功编译，无错误
- ✅ 代码结构符合调用方要求
- ✅ 代码完全实现，无空框架或占位符
- ✅ 代码注释清晰，易于后续维护

## Resources

此技能不包含额外的 scripts、references 或 assets，所有必要的指导都已包含在 SKILL.md 中。工作流程通过 Unity 内置工具（`unity_script`、`unity_editor`、`unity_console`）完成。
